<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cubo 3D Interactivo con Audios Locales</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #121212;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    user-select: none;
    overflow: hidden;
  }

  .scene {
    width: 200px;
    height: 200px;
    perspective: 1000px;
    user-select: none;
    touch-action: none;
  }
  .cube {
    width: 200px;
    height: 200px;
    position: relative;
    transform-style: preserve-3d;
    cursor: grab;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(255,64,129,0.7);
    transition: box-shadow 0.3s ease;
  }
  .cube:active {
    cursor: grabbing;
    box-shadow: 0 0 25px rgba(255,64,129,1);
  }
  .face {
    position: absolute;
    width: 200px;
    height: 200px;
    border: 2px solid #fff;
    box-sizing: border-box;
    backface-visibility: hidden;
    border-radius: 8px;
    overflow: hidden;
    background: #222;
  }
  .face img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    user-select: none;
    pointer-events: none;
  }
  .front  { transform: translateZ(100px); }
  .back   { transform: rotateY(180deg) translateZ(100px); }
  .right  { transform: rotateY(90deg) translateZ(100px); }
  .left   { transform: rotateY(-90deg) translateZ(100px); }
  .top    { transform: rotateX(90deg) translateZ(100px); }
  .bottom { transform: rotateX(-90deg) translateZ(100px); }

  #bottomText {
    margin-top: 40px;
    font-family: "Comic Sans MS", cursive, sans-serif;
    font-size: 1.5rem;
    font-weight: bold;
    color: #ff4081;
    animation: colorJump 2s infinite;
    user-select: none;
    text-align: center;
    max-width: 300px;
    line-height: 1.2;
  }
  @keyframes colorJump {
    0%, 100% { color: #ff4081; transform: translateY(0); }
    50% { color: #40c4ff; transform: translateY(-15px); }
  }

  .confetti-piece {
    position: fixed;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    pointer-events: none;
    animation-name: confetti-fall;
    animation-timing-function: linear;
    animation-fill-mode: forwards;
  }
  @keyframes confetti-fall {
    to {
      transform: translateY(100vh) rotate(360deg);
      opacity: 0;
    }
  }

  #birthdayText {
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translateX(-50%);
    font-family: "Comic Sans MS", cursive, sans-serif;
    font-size: 1.8rem;
    color: #ff4081;
    font-weight: bold;
    display: flex;
    gap: 0.1em;
    pointer-events: none;
    z-index: 10000;
    user-select: none;
  }
  #birthdayText span {
    display: inline-block;
    animation-name: jump;
    animation-duration: 0.6s;
    animation-timing-function: ease;
    animation-iteration-count: infinite;
  }
  @keyframes jump {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
  }
</style>
</head>
<body>

<div class="scene" id="scene" aria-label="Cubo 3D interactivo" role="application" tabindex="0">
  <div class="cube" id="cube" style="transform: rotateX(-15deg) rotateY(0deg);">
    <div class="face front"><img src="images/1.jpg" alt="Frontal" /></div>
    <div class="face back"><img src="images/2.jpg" alt="Trasera" /></div>
    <div class="face right"><img src="images/3.jpg" alt="Derecha" /></div>
    <div class="face left"><img src="images/4.jpg" alt="Izquierda" /></div>
    <div class="face top"><img src="images/5.jpg" alt="Superior" /></div>
    <div class="face bottom"><img src="images/6.jpg" alt="Inferior" /></div>
  </div>
</div>

<div id="bottomText">Fati no es mucho pero me esforcé</div>

<script>
  (function(){
    const cube = document.getElementById('cube');
    const scene = document.getElementById('scene');

    // Audios locales en carpeta "audios"
    const soundUrls = [
      'audios/sound0.ogg',
      'audios/sound1.ogg',
      'audios/sound2.ogg',
      'audios/sound3.ogg',
      'audios/sound4.ogg',
      'audios/sound5.ogg',
    ];

    // Crear objetos Audio y precargar
    const sounds = soundUrls.map(url => {
      const audio = new Audio(url);
      audio.preload = 'auto';
      return audio;
    });

    let rotationX = -15;
    let rotationY = 0;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let lastRotationX = rotationX;
    let lastRotationY = rotationY;
    let currentPlayingSound = null;
    let lastFaceIndex = -1;

    function updateCube() {
      cube.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
      detectActiveFace();
    }

    function detectActiveFace() {
      const normX = ((rotationX % 360) + 360) % 360;
      const normY = ((rotationY % 360) + 360) % 360;

      let faceIndex = 0;

      if (normX > 45 && normX < 135) {
        faceIndex = 5; // Inferior
      } else if (normX > 225 && normX < 315) {
        faceIndex = 4; // Superior
      } else {
        if (normY >= 315 || normY < 45) {
          faceIndex = 0; // Frontal
        } else if (normY >= 45 && normY < 135) {
          faceIndex = 1; // Derecha
        } else if (normY >= 135 && normY < 225) {
          faceIndex = 2; // Trasera
        } else if (normY >= 225 && normY < 315) {
          faceIndex = 3; // Izquierda
        }
      }

      if(faceIndex !== lastFaceIndex) {
        playSound(faceIndex);
        lastFaceIndex = faceIndex;
      }
    }

    function playSound(index) {
      if (currentPlayingSound && !currentPlayingSound.paused) {
        currentPlayingSound.pause();
        currentPlayingSound.currentTime = 0;
      }
      currentPlayingSound = sounds[index];
      // Reproducir solo si está listo
      if(currentPlayingSound.readyState >= 2) {
        currentPlayingSound.play().catch(() => {});
      } else {
        // Si no está listo, esperar a que cargue
        currentPlayingSound.addEventListener('canplaythrough', () => {
          currentPlayingSound.play().catch(() => {});
        }, { once: true });
      }
    }

    // Eventos para arrastrar con mouse
    scene.addEventListener('mousedown', e => {
      isDragging = true;
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      lastRotationX = rotationX;
      lastRotationY = rotationY;
      e.preventDefault();
    });
    window.addEventListener('mouseup', e => {
      isDragging = false;
    });
    window.addEventListener('mousemove', e => {
      if (!isDragging) return;
      const deltaX = e.clientX - dragStartX;
      const deltaY = e.clientY - dragStartY;
      rotationY = lastRotationY + deltaX * 0.5;
      rotationX = lastRotationX - deltaY * 0.5;
      updateCube();
    });

    // Eventos táctiles para móvil
    scene.addEventListener('touchstart', e => {
      if (e.touches.length === 1) {
        isDragging = true;
        dragStartX = e.touches[0].clientX;
        dragStartY = e.touches[0].clientY;
        lastRotationX = rotationX;
        lastRotationY = rotationY;
      }
    });
    window.addEventListener('touchend', e => {
      isDragging = false;
    });
    window.addEventListener('touchmove', e => {
      if (!isDragging || e.touches.length !== 1) return;
      const deltaX = e.touches[0].clientX - dragStartX;
      const deltaY = e.touches[0].clientY - dragStartY;
      rotationY = lastRotationY + deltaX * 0.5;
      rotationX = lastRotationX - deltaY * 0.5;
      updateCube();
    }, { passive: false });

    // Control con teclado (flechas)
    window.addEventListener('keydown', e => {
      switch(e.key) {
        case 'ArrowLeft':
          rotationY -= 8;
          break;
        case 'ArrowRight':
          rotationY += 8;
          break;
        case 'ArrowUp':
          rotationX -= 8;
          break;
        case 'ArrowDown':
          rotationX += 8;
          break;
      }
      updateCube();
    });

    // Confeti al doble clic o doble tap
    let lastTap = 0;
    scene.addEventListener('dblclick', () => {
      launchConfettiWithText();
    });
    scene.addEventListener('touchend', e => {
      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTap;
      if (tapLength < 300 && tapLength > 0) {
        launchConfettiWithText();
        e.preventDefault();
      }
      lastTap = currentTime;
    });

    function launchConfetti() {
      const count = 150;
      for(let i=0; i<count; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti-piece');
        confetti.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
        confetti.style.left = `${Math.random()*100}vw`;
        confetti.style.top = `-10px`;
        confetti.style.animationDuration = `${2 + Math.random()*3}s`;
        confetti.style.animationDelay = `${Math.random()*3}s`;
        document.body.appendChild(confetti);
        confetti.addEventListener('animationend', () => {
          confetti.remove();
        });
      }
    }

    function launchConfettiWithText() {
      launchConfetti();

      let textContainer = document.getElementById('birthdayText');
      if (textContainer) {
        textContainer.remove();
      }
      textContainer = document.createElement('div');
      textContainer.id = 'birthdayText';

      const message = 'feliz cumpleaños Fati tqm';
      for(let i=0; i<message.length; i++) {
        const span = document.createElement('span');
        span.textContent = message[i];
        span.style.animationDelay = `${i * 0.15}s`;
        textContainer.appendChild(span);
      }

      document.body.appendChild(textContainer);

      setTimeout(() => {
        if (textContainer) {
          textContainer.remove();
        }
      }, 5000);
    }

    updateCube();
  })();
</script>

</body>
</html>
